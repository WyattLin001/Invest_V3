# 錦標賽投資模擬系統使用說明

## 📋 系統概述

錦標賽投資模擬系統是一個完整的投資競賽平台，讓用戶可以在不同的錦標賽中進行模擬投資，追蹤績效表現，並與其他投資者競爭排名。

## 🚀 主要功能

### 1. **投資模擬啟動**
- 點擊「開始投資模擬」按鈕
- 系統會自動：
  - 驗證用戶身份
  - 載入可參加的錦標賽
  - 為每個錦標賽初始化獨立的投資組合
  - 同步資料到後端資料庫
  - 計算初始排名和績效

### 2. **獨立錦標賽投資組合**
- 每個錦標賽都有獨立的：
  - 初始資金（依錦標賽規則設定）
  - 持股記錄
  - 交易歷史
  - 績效表現
  - 排名位置

### 3. **實時排名系統**
- 根據多項指標計算排名：
  - **總收益率** (40% 權重)
  - **風險調整收益** (30% 權重) 
  - **穩定性** (20% 權重)
  - **交易活躍度** (10% 權重)

### 4. **績效追蹤**
- **投資組合價值**：實時計算總價值
- **收益率**：總收益和百分比收益
- **風險指標**：最大回撤、夏普比率
- **交易統計**：勝率、交易次數、平均持股天數

### 5. **後端數據同步**
- 所有交易記錄自動同步到 Supabase 資料庫
- 投資組合狀態實時更新
- 排名變動即時反映
- 歷史數據完整保存

## 📊 使用流程

### Step 1: 啟動投資模擬
```
1. 打開投資模擬頁面
2. 點擊「開始投資模擬」按鈕
3. 等待系統初始化完成
4. 查看參與的錦標賽列表
```

### Step 2: 查看錦標賽資訊
```
1. 在「參與的錦標賽」區域查看所有錦標賽
2. 點擊錦標賽卡片查看詳細資訊
3. 檢視當前排名和績效表現
4. 了解錦標賽規則和時間安排
```

### Step 3: 執行投資交易
```
1. 選擇要交易的錦標賽
2. 使用現有的交易介面進行買賣
3. 系統自動記錄到對應的錦標賽投資組合
4. 排名和績效即時更新
```

### Step 4: 追蹤績效和排名
```
1. 查看投資摘要了解整體表現
2. 監控各錦標賽的排名變化
3. 分析交易記錄和績效指標
4. 調整投資策略優化表現
```

## 🎯 關鍵特色

### ✅ **多錦標賽管理**
- 同時參與多個錦標賽
- 每個錦標賽獨立的投資組合
- 不同錦標賽規則和時間安排

### ✅ **即時排名計算**
- 綜合績效指標計算排名
- 實時更新排名變動
- 排名歷史記錄追蹤

### ✅ **完整績效分析**
- 多維度績效指標
- 風險調整收益計算
- 交易行為分析

### ✅ **資料庫同步**
- 自動備份所有交易記錄
- 跨設備數據同步
- 歷史數據永久保存

## 🛠 技術架構

### 核心組件
- **TournamentSimulationService**: 投資模擬主服務
- **TournamentPortfolioManager**: 錦標賽投資組合管理
- **TournamentRankingSystem**: 排名計算系統
- **InvestmentSimulationView**: 主介面

### 資料庫結構
- `tournaments`: 錦標賽基本資訊
- `tournament_portfolios`: 投資組合資料
- `tournament_holdings`: 持股記錄
- `tournament_participants`: 參賽者排名
- `tournament_trading_records`: 交易記錄
- `tournament_performance_metrics`: 績效指標

## 🔧 開發者說明

### 集成到現有應用
```swift
// 在需要的地方添加投資模擬入口
NavigationLink("投資模擬", destination: InvestmentSimulationView())

// 或者直接使用服務
let simulationService = TournamentSimulationService.shared
await simulationService.startInvestmentSimulation()
```

### 自定義錦標賽規則
```swift
// 在 Tournament 模型中設定規則
let tournament = Tournament(
    initialBalance: 1000000,  // 初始資金
    riskLimitPercentage: 20,  // 風險限制
    minHoldingRate: 70,       // 最低持股率
    maxSingleStockRate: 25    // 單股持股上限
)
```

### 後端 API 整合
```swift
// 實現 SupabaseService 擴展中的方法
extension SupabaseService {
    func fetchAvailableTournaments() async throws -> [Tournament] {
        // 從資料庫獲取錦標賽資料
    }
    
    func syncTournamentPortfolio(_ portfolio: TournamentPortfolio) async throws {
        // 同步投資組合到後端
    }
}
```

## 📝 注意事項

1. **初次使用**：首次啟動時需要等待系統初始化，這可能需要幾秒鐘時間

2. **網路連線**：部分功能需要網路連線進行資料同步，離線時使用本地數據

3. **錦標賽規則**：每個錦標賽都有不同的規則限制，請仔細閱讀錦標賽說明

4. **排名更新**：排名每次交易後會重新計算，可能需要幾秒鐘時間

5. **數據備份**：所有交易記錄都會自動備份到雲端，無需手動操作

## 🔮 未來擴展

- 錦標賽創建和管理功能
- 更多績效分析工具
- 社交功能和群組競賽
- 實時聊天和討論
- 獎勵和成就系統

---

💡 **提示**：如有任何問題或建議，請聯絡開發團隊或查看更詳細的技術文件。