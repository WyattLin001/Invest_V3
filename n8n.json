{
  "name": "每日 7AM 投資文章自動生成",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "days",
              "value": 1
            }
          ]
        },
        "triggerAtHour": 7,
        "triggerAtMinute": 0,
        "triggerAtSecond": 0
      },
      "name": "每日觸發",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [250, 150]
    },
    {
      "parameters": {
        "resource": "rssFeed",
        "operation": "getAll",
        "rssFeedUrl": "={{ $json[\"rssUrl\"] }}",
        "limit": 3
      },
      "name": "拉取今日 RSS",
      "type": "n8n-nodes-base.rssFeedRead",
      "typeVersion": 1,
      "position": [450, 150],
      "credentials": {
        "rssFeedReadApi": {}
      }
    },
    {
      "parameters": {
        "functionCode": "const topics = items[0].json;\nconst headlines = topics.map(i=>i.title).join('; ');\nreturn [{ json: { headlines } }];"
      },
      "name": "提取標題摘要",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [650, 150]
    },
    {
      "parameters": {
        "model": "gpt-o3",
        "temperature": 0.7,
        "maxTokens": 1500,
        "prompt": "你是股圈投資平台的專業財經分析師。基於以下新聞摘要，撰寫一篇針對台灣投資者的深度分析文章：\n\n今日新聞摘要：{{ $json.headlines }}\n\n請依照以下格式撰寫：\n# 標題（20字內）\n\n## 關鍵要點（3點）\n\n## 深度分析\n\n## 投資啟示\n\n## 風險提醒\n\n文章風格：專業但易懂，800-1000字。"
      },
      "name": "AI 生成文章",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 2,
      "position": [850, 150],
      "credentials": {
        "openAIApi": {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
          "id": "OpenAI API",
          "name": "OpenAI API"
        }
      }
    },
    {
      "parameters": {
        "operation": "insert",
        "table": "auto_articles",
        "columnsUi": {
          "column": [
            {
              "column": "title",
              "value": "={{ $json.choices[0].message.content.split('\\n')[0].replace('# ', '') }}"
            },
            {
              "column": "content",
              "value": "={{ $json.choices[0].message.content }}"
            },
            {
              "column": "category",
              "value": "investment_analysis"
            },
            {
              "column": "status",
              "value": "draft"
            },
            {
              "column": "ai_model",
              "value": "gpt-o3"
            },
            {
              "column": "generation_cost",
              "value": "={{ ($json.usage.prompt_tokens * 0.000002 + $json.usage.completion_tokens * 0.000008).toFixed(4) }}"
            },
            {
              "column": "source_seeds",
              "value": "=[]
            }
          ]
        }
      },
      "name": "保存草稿至 Supabase",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [1050, 150],
      "credentials": {
        "supabaseApi": {
          "id": "Supabase",
          "name": "Supabase"
        }
      }
    },
    {
      "parameters": {
        "channel": "#content-review",
        "text": "📝 新文章已生成，請快速審核：\n標題：{{ $json as any }}\n連結：{{ $env.ADMIN_URL }}/drafts"
      },
      "name": "Slack 通知審核",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 1,
      "position": [1250, 150],
      "credentials": {
        "slackApi": {
          "id": "Slack API",
          "name": "Slack API"
        }
      }
    }
  ],
  "connections": {
    "每日觸發": {
      "main": [
        [
          {
            "node": "拉取今日 RSS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "拉取今日 RSS": {
      "main": [
        [
          {
            "node": "提取標題摘要",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "提取標題摘要": {
      "main": [
        [
          {
            "node": "AI 生成文章",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI 生成文章": {
      "main": [
        [
          {
            "node": "保存草稿至 Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "保存草稿至 Supabase": {
      "main": [
        [
          {
            "node": "Slack 通知審核",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {},
  "tags": []
}