{
  "name": "Slack審核Webhook處理_簡化版",
  "nodes": [
    {
      "parameters": {
        "path": "slack-review",
        "options": {}
      },
      "name": "Webhook接收",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 300],
      "id": "webhook-receive"
    },
    {
      "parameters": {
        "functionCode": "// 簡化的Slack負載解析\ntry {\n  const payload = JSON.parse($json.body.payload);\n  const action = payload.actions[0];\n  const user = payload.user;\n  const articleId = action.value.split('_')[1];\n  \n  let newStatus = 'draft';\n  let actionType = action.action_id;\n  \n  if (actionType === 'approve_article') {\n    newStatus = 'published';\n  } else if (actionType === 'reject_article') {\n    newStatus = 'archived';\n  } else if (actionType === 'revise_article') {\n    newStatus = 'review';\n  }\n  \n  return [{\n    json: {\n      articleId: articleId,\n      newStatus: newStatus,\n      actionType: actionType,\n      moderator: user.name,\n      moderatorId: user.id,\n      responseUrl: payload.response_url,\n      timestamp: new Date().toISOString()\n    }\n  }];\n} catch (error) {\n  return [{\n    json: {\n      error: 'Failed to parse Slack payload',\n      details: error.message\n    }\n  }];\n}"
      },
      "name": "解析審核",
      "type": "n8n-nodes-base.function",
      "typeVersion": 2,
      "position": [460, 300],
      "id": "parse-review"
    },
    {
      "parameters": {
        "schema": "public",
        "table": "articles",
        "operation": "update",
        "filterType": "manual",
        "matchingColumns": [
          {
            "column": "id",
            "value": "={{ $json.articleId }}"
          }
        ],
        "columnsUi": {
          "columnToMatchOn": [
            {
              "column": "status",
              "value": "={{ $json.newStatus }}"
            },
            {
              "column": "updated_at",
              "value": "={{ $json.timestamp }}"
            }
          ]
        }
      },
      "name": "更新狀態",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [680, 300],
      "credentials": {
        "supabaseApi": {
          "id": "supabase_credentials",
          "name": "Supabase API"
        }
      },
      "id": "update-status"
    },
    {
      "parameters": {
        "url": "={{ $json.responseUrl }}",
        "sendBody": true,
        "bodyContentType": "json",
        "jsonBody": "{\n  \"text\": \"審核處理完成\",\n  \"response_type\": \"in_channel\",\n  \"replace_original\": true,\n  \"blocks\": [\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"{{ $json.newStatus === 'published' ? '✅ *文章已通過審核並發布*' : $json.newStatus === 'archived' ? '❌ *文章已拒絕發布*' : '📝 *文章需要修改*' }}\\n\\n*審核者：* {{ $json.moderator }}\\n*處理時間：* {{ $json.timestamp }}\\n*新狀態：* {{ $json.newStatus }}\"\n      }\n    }\n  ]\n}",
        "options": {}
      },
      "name": "回應Slack",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [900, 300],
      "id": "response-slack"
    }
  ],
  "connections": {
    "Webhook接收": {
      "main": [
        [
          {
            "node": "解析審核",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "解析審核": {
      "main": [
        [
          {
            "node": "更新狀態",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "更新狀態": {
      "main": [
        [
          {
            "node": "回應Slack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "timezone": "Asia/Taipei",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-08-01T08:00:00.000Z",
      "updatedAt": "2025-08-01T08:00:00.000Z",
      "id": "webhook-handler",
      "name": "Webhook處理"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2025-08-01T08:00:00.000Z",
  "versionId": "webhook-simplified-1.0"
}