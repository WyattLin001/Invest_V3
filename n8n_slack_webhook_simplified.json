{
  "name": "Slackå¯©æ ¸Webhookè™•ç†_ç°¡åŒ–ç‰ˆ",
  "nodes": [
    {
      "parameters": {
        "path": "slack-review",
        "options": {}
      },
      "name": "Webhookæ¥æ”¶",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 300],
      "id": "webhook-receive"
    },
    {
      "parameters": {
        "functionCode": "// ç°¡åŒ–çš„Slackè² è¼‰è§£æ\ntry {\n  const payload = JSON.parse($json.body.payload);\n  const action = payload.actions[0];\n  const user = payload.user;\n  const articleId = action.value.split('_')[1];\n  \n  let newStatus = 'draft';\n  let actionType = action.action_id;\n  \n  if (actionType === 'approve_article') {\n    newStatus = 'published';\n  } else if (actionType === 'reject_article') {\n    newStatus = 'archived';\n  } else if (actionType === 'revise_article') {\n    newStatus = 'review';\n  }\n  \n  return [{\n    json: {\n      articleId: articleId,\n      newStatus: newStatus,\n      actionType: actionType,\n      moderator: user.name,\n      moderatorId: user.id,\n      responseUrl: payload.response_url,\n      timestamp: new Date().toISOString()\n    }\n  }];\n} catch (error) {\n  return [{\n    json: {\n      error: 'Failed to parse Slack payload',\n      details: error.message\n    }\n  }];\n}"
      },
      "name": "è§£æå¯©æ ¸",
      "type": "n8n-nodes-base.function",
      "typeVersion": 2,
      "position": [460, 300],
      "id": "parse-review"
    },
    {
      "parameters": {
        "schema": "public",
        "table": "articles",
        "operation": "update",
        "filterType": "manual",
        "matchingColumns": [
          {
            "column": "id",
            "value": "={{ $json.articleId }}"
          }
        ],
        "columnsUi": {
          "columnToMatchOn": [
            {
              "column": "status",
              "value": "={{ $json.newStatus }}"
            },
            {
              "column": "updated_at",
              "value": "={{ $json.timestamp }}"
            }
          ]
        }
      },
      "name": "æ›´æ–°ç‹€æ…‹",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [680, 300],
      "credentials": {
        "supabaseApi": {
          "id": "supabase_credentials",
          "name": "Supabase API"
        }
      },
      "id": "update-status"
    },
    {
      "parameters": {
        "url": "={{ $json.responseUrl }}",
        "sendBody": true,
        "bodyContentType": "json",
        "jsonBody": "{\n  \"text\": \"å¯©æ ¸è™•ç†å®Œæˆ\",\n  \"response_type\": \"in_channel\",\n  \"replace_original\": true,\n  \"blocks\": [\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"{{ $json.newStatus === 'published' ? 'âœ… *æ–‡ç« å·²é€šéå¯©æ ¸ä¸¦ç™¼å¸ƒ*' : $json.newStatus === 'archived' ? 'âŒ *æ–‡ç« å·²æ‹’çµ•ç™¼å¸ƒ*' : 'ğŸ“ *æ–‡ç« éœ€è¦ä¿®æ”¹*' }}\\n\\n*å¯©æ ¸è€…ï¼š* {{ $json.moderator }}\\n*è™•ç†æ™‚é–“ï¼š* {{ $json.timestamp }}\\n*æ–°ç‹€æ…‹ï¼š* {{ $json.newStatus }}\"\n      }\n    }\n  ]\n}",
        "options": {}
      },
      "name": "å›æ‡‰Slack",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [900, 300],
      "id": "response-slack"
    }
  ],
  "connections": {
    "Webhookæ¥æ”¶": {
      "main": [
        [
          {
            "node": "è§£æå¯©æ ¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è§£æå¯©æ ¸": {
      "main": [
        [
          {
            "node": "æ›´æ–°ç‹€æ…‹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ›´æ–°ç‹€æ…‹": {
      "main": [
        [
          {
            "node": "å›æ‡‰Slack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "timezone": "Asia/Taipei",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-08-01T08:00:00.000Z",
      "updatedAt": "2025-08-01T08:00:00.000Z",
      "id": "webhook-handler",
      "name": "Webhookè™•ç†"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2025-08-01T08:00:00.000Z",
  "versionId": "webhook-simplified-1.0"
}